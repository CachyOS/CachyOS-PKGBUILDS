# Maintainer: Peter Jung <ptr1337@cachyos.org>

pkgname=falcond
pkgver=1.1.9
pkgrel=1
pkgdesc='Advanced Linux Gaming Performance Daemon'
url='https://github.com/PikaOS-Linux/falcond'
license=('MIT')
depends=(
  glibc
)
makedepends=(
  git
  zig
)
arch=(x86_64)
source=(git+https://github.com/PikaOS-Linux/falcond#tag=v${pkgver}
        git+https://github.com/PikaOS-Linux/falcond-profiles.git
        falcond.service)
sha256sums=('769883a746ee8e157bbc75a05e1b5e6979dea5c48eb0eeb9c313d541a3e319e1'
            'SKIP'
            '2c53ee97c65d5e025b6b4d04a4f740187604a42259d7adbd05c8d04ac1e5e0b9')
b2sums=('5d8858101e107805899ca11461039f4982e3fe7dfef20d33c66925c5e95b9cc532d7133976f484f3f28269293525b6b78d5c995c7ac41bc049cb676b3db7c429'
        'SKIP'
        'd52e0d3c79b348d698e73173efcadefee8308e0fbf7c60c3053f5a3d192e53a36da28e89df43c894c9e36363da2db5456f65d873730aef93faf69bad25c3e9c0')
validpgpkeys=('74460D32B80810EBA9AFA2E962394C698C2739FA') # Yoran Heling <projects@yorhel.nl>

build() {
  cd "${pkgname}"/$pkgname

  DESTDIR="build" zig build \
    --summary all \
    --global-cache-dir ../zig-global-cache \
    --prefix /usr \
    --search-prefix /usr \
    --release=safe \
    -Dtarget=native-linux.6.1-gnu.2.38 \
    -Dcpu=baseline
}

package() {
  cd "${pkgname}"/$pkgname
  cp -a build/* "$pkgdir"
  mkdir -p $pkgdir/usr/share/falcond
  cp -r $srcdir/falcond-profiles/usr/share/falcond $pkgdir/usr/share
  mkdir -p $pkgdir/usr/lib/systemd/system/
  cp $srcdir/falcond.service $pkgdir/usr/lib/systemd/system/falcond.service
  install --verbose -D --mode=644 ../LICENSE "${pkgdir}/usr/share/licenses/${pkgname}/LICENSE"
}
