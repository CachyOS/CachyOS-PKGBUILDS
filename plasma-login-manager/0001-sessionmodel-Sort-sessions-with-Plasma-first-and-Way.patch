From 9644529d33c4d651a26566a9feaebdaaa860ecff Mon Sep 17 00:00:00 2001
From: Peter Jung <admin@ptr1337.dev>
Date: Wed, 18 Feb 2026 12:42:17 +0100
Subject: [PATCH] sessionmodel: Sort sessions with Plasma first and Wayland
 before X11

When no previous session is remembered, the greeter defaults to the
first entry in the session list. Sort sessions so that Plasma (Wayland)
appears at index 0 by default.

The ordering applied is:
 - Plasma sessions always first (detected by filename, not the translated display name)
 - Other sessions sorted alphabetically by display name
 - Within the same display name, Wayland before X11

Signed-off-by: Peter Jung <admin@ptr1337.dev>
---
 src/frontend/settings/models/sessionmodel.cpp | 18 ++++++++++++++++++
 1 file changed, 18 insertions(+)

diff --git a/src/frontend/settings/models/sessionmodel.cpp b/src/frontend/settings/models/sessionmodel.cpp
index 42710d8..64fc40a 100644
--- a/src/frontend/settings/models/sessionmodel.cpp
+++ b/src/frontend/settings/models/sessionmodel.cpp
@@ -4,6 +4,8 @@
  *  SPDX-License-Identifier: GPL-2.0-only OR GPL-3.0-only OR LicenseRef-KDE-Accepted-GPL
  */
 
+#include <algorithm>
+
 #include <QDir>
 #include <QFileSystemWatcher>
 #include <QStandardPaths>
@@ -190,6 +192,22 @@ void SessionModel::populate(const QStringList &xSessionPaths, const QStringList
     m_sessions << Session(Session::Type::X11, "/foo/bar3.desktop", "Plasma", "This is Plasma X11 1");
     */
 
+    // Sort sessions: Plasma first, then alphabetical by display name, Wayland before X11 within each name group
+    std::stable_sort(m_sessions.begin(), m_sessions.end(), [](const Session &a, const Session &b) {
+        // Use the filename (e.g. "plasma.desktop", "plasmax11.desktop") rather than displayName
+        // to identify Plasma sessions, as displayName is a translated string
+        const bool aIsPlasma = QFileInfo(a.path).completeBaseName().startsWith(QStringLiteral("plasma"), Qt::CaseInsensitive);
+        const bool bIsPlasma = QFileInfo(b.path).completeBaseName().startsWith(QStringLiteral("plasma"), Qt::CaseInsensitive);
+        if (aIsPlasma != bIsPlasma) {
+            return aIsPlasma;
+        }
+        if (a.displayName != b.displayName) {
+            return a.displayName < b.displayName;
+        }
+        // Same display name: Wayland (1) before X11 (0) â€” sort descending by type value
+        return a.type > b.type;
+    });
+
     endResetModel();
 }
 
-- 
2.53.0

