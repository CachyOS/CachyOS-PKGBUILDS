pkgbase=python
pkgname=(python python-tests)
pkgver=3.12.1
pkgrel=2
_pybasever=${pkgver%.*}
pkgdesc=Regression tests packages for Python
arch=(x86_64)
license=(custom)
url=https://www.python.org/
depends=(python)
makedepends=(tk sqlite bluez-libs mpdecimal llvm-bolt gdb xorg-server-xvfb ttf-font)
source=('("https://www.python.org/ftp/python/${pkgver%rc*}/Python-${pkgver}.tar.xz"{,.asc}'
"bolt2.patch"'
sha512sums=(434e727fa370def348838fd84acb69b4d309cfb03f61bf5069150164e9ca005637ac01dfbf997f445607d4e28d02c8bed0858b36589240ccadaa4c14c19f2320
validpgpkeys=(0D96DF4D4110E5C43FBFB17F2D347EA6AA65421D  # Ned Deily (Python release signing key) <nad@python.org>
export CFLAGS+= -fno-semantic-interposition
export CXXLAGS+= -fno-semantic-interposition
CFLAGS=${CFLAGS/-O2/-O3}
./configure --prefix=/usr \
--with-dbmliborder=gdbm:ndbm \
--with-tzpath=/usr/share/zoneinfo
export servernum=99
while ! xvfb-run -a -n "$servernum" /bin/true 2>/dev/null; do servernum=$((servernum+1)); done
LC_CTYPE=en_US.UTF-8 xvfb-run -s -screen 0 1920x1080x16 -ac +extension GLX -a -n $servernum \
LD_LIBRARY_PATH=${srcdir}/Python-${pkgver}:${LD_LIBRARY_PATH} \
optdepends=(python-setuptools
provides=(python3 python-externally-managed)
replaces=(python3 python-externally-managed)
make DESTDIR=${pkgdir} EXTRA_CFLAGS
