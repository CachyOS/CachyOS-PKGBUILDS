From 7739242b4909e6b3037d8a59304a6d107e99cba8 Mon Sep 17 00:00:00 2001
From: Vladislav Nepogodin <nepogodin.vlad@gmail.com>
Date: Mon, 10 Nov 2025 03:11:33 +0400
Subject: [PATCH] deps: use latest alpm crate commit

---
 rust/Cargo.lock           | 19 ++++++++-----------
 rust/Cargo.toml           |  4 ++++
 rust/aura-core/Cargo.toml |  3 +++
 rust/aura-pm/Cargo.toml   |  2 +-
 rust/r2d2-alpm/Cargo.toml |  5 ++++-
 5 files changed, 20 insertions(+), 13 deletions(-)

diff --git a/rust/Cargo.lock b/rust/Cargo.lock
index 21b88b4e..37cb4fb4 100644
--- a/rust/Cargo.lock
+++ b/rust/Cargo.lock
@@ -1,12 +1,11 @@
 # This file is automatically @generated by Cargo.
 # It is not intended for manual editing.
-version = 3
+version = 4
 
 [[package]]
 name = "alpm"
-version = "4.0.1"
-source = "registry+https://github.com/rust-lang/crates.io-index"
-checksum = "c02d4b4d6bc861451437cdbd7feb35385874ff4cc449ace8e793fe8c30533240"
+version = "4.0.3"
+source = "git+https://github.com/archlinux/alpm.rs?rev=54b8bdcdce2b04d12a180f1fd4b304cc8cf4cc1a#54b8bdcdce2b04d12a180f1fd4b304cc8cf4cc1a"
 dependencies = [
  "alpm-sys",
  "bitflags",
@@ -14,9 +13,8 @@ dependencies = [
 
 [[package]]
 name = "alpm-sys"
-version = "4.0.0"
-source = "registry+https://github.com/rust-lang/crates.io-index"
-checksum = "ad5eb56a41bf4f036c600aa1ddff354971926dd8ea29a3fb6589c6c375bf918b"
+version = "4.0.3"
+source = "git+https://github.com/archlinux/alpm.rs?rev=54b8bdcdce2b04d12a180f1fd4b304cc8cf4cc1a#54b8bdcdce2b04d12a180f1fd4b304cc8cf4cc1a"
 dependencies = [
  "pkg-config",
 ]
@@ -24,8 +22,7 @@ dependencies = [
 [[package]]
 name = "alpm-utils"
 version = "4.0.1"
-source = "registry+https://github.com/rust-lang/crates.io-index"
-checksum = "7a56cf9221faa08b5a59a9f429cc5338d8e77e22e1d7fe7d3179fc5c3acf7fc3"
+source = "git+https://github.com/archlinux/alpm.rs?rev=54b8bdcdce2b04d12a180f1fd4b304cc8cf4cc1a#54b8bdcdce2b04d12a180f1fd4b304cc8cf4cc1a"
 dependencies = [
  "alpm",
  "pacmanconf",
@@ -716,9 +713,9 @@ dependencies = [
 
 [[package]]
 name = "pacmanconf"
-version = "3.0.0"
+version = "3.1.0"
 source = "registry+https://github.com/rust-lang/crates.io-index"
-checksum = "5be1f202256ab200a4fdaaad0988015987876b0aa336ca7a7e685080bab58a40"
+checksum = "1087f8994e545eed9f7453376282f2964f18ca4b739e42f0dc7f2fed246d76c3"
 dependencies = [
  "cini",
 ]
diff --git a/rust/Cargo.toml b/rust/Cargo.toml
index 9a95a571..75063914 100644
--- a/rust/Cargo.toml
+++ b/rust/Cargo.toml
@@ -15,3 +15,7 @@ panic = "abort"
 strip = true
 opt-level = "z"  # Reduces final stripped size by ~20%.
 codegen-units = 1
+
+[patch.crates-io]
+alpm = { git = "https://github.com/archlinux/alpm.rs", rev = "54b8bdcdce2b04d12a180f1fd4b304cc8cf4cc1a" }
+alpm-utils = { git = "https://github.com/archlinux/alpm.rs", rev = "54b8bdcdce2b04d12a180f1fd4b304cc8cf4cc1a" }
diff --git a/rust/aura-core/Cargo.toml b/rust/aura-core/Cargo.toml
index 0d5ae100..f6d512eb 100644
--- a/rust/aura-core/Cargo.toml
+++ b/rust/aura-core/Cargo.toml
@@ -28,3 +28,6 @@ time = { version = "0.3", features = ["serde", "local-offset"] }
 validated = { version = "0.4", features = ["rayon"] }
 versions = "6.3.2"
 walkdir = "2.5"
+
+[features]
+git = ["alpm/git", "alpm-utils/git", "r2d2-alpm/git"]
diff --git a/rust/aura-pm/Cargo.toml b/rust/aura-pm/Cargo.toml
index bf0fab6b..0eabca95 100644
--- a/rust/aura-pm/Cargo.toml
+++ b/rust/aura-pm/Cargo.toml
@@ -47,7 +47,7 @@ which = "6.0"
 whoami = "1.5"
 
 [features]
-git = ["alpm/git"]
+git = ["alpm/git", "r2d2-alpm/git", "aura-core/git"]
 
 [profile.release]
 lto = true
diff --git a/rust/r2d2-alpm/Cargo.toml b/rust/r2d2-alpm/Cargo.toml
index 2f03caf7..3ba73485 100644
--- a/rust/r2d2-alpm/Cargo.toml
+++ b/rust/r2d2-alpm/Cargo.toml
@@ -12,8 +12,11 @@ keywords = ["database", "pool", "archlinux", "alpm", "pacman"]
 [dependencies]
 alpm = "4.0"
 alpm-utils = "4.0"
-pacmanconf = "3.0"
+pacmanconf = "3.1"
 r2d2 = "0.8"
 
 [dev-dependencies]
 rayon = "1.8"
+
+[features]
+git = ["alpm/git", "alpm-utils/git"]
-- 
2.51.2

